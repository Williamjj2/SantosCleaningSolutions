(function(){'use strict';console.log('ðŸ”§ Santos Cleaning Solutions - Atualizador React carregando...');let statsData=null;let updateInterval=null;async function fetchStats(){try{const response=await fetch('/api/reviews/stats',{method:'GET',headers:{'Content-Type':'application/json','Cache-Control':'no-cache'}});if(response.ok){const data=await response.json();console.log('ðŸ“Š Stats recebidos:',data);return data;}else{throw new Error(`HTTP ${response.status}`);}}catch(error){console.error('âŒ Erro ao buscar stats:',error);return null;}}
function updateRatingElements(){if(!statsData)return;const langPhrases=[{has:(t)=>/based on/i.test(t)&&/google reviews/i.test(t),render:(n)=>`Based on ${n}+Google reviews`},{has:(t)=>/baseado em/i.test(t)&&/avaliaÃ§Ãµes do google/i.test(t),render:(n)=>`Baseado em ${n}+avaliaÃ§Ãµes do Google`},{has:(t)=>/basado en/i.test(t)&&/reseÃ±as de google/i.test(t),render:(n)=>`Basado en ${n}+reseÃ±as de Google`}];const candidates=[];document.querySelectorAll('body *:not(script):not(style)').forEach(el=>{if(el.children.length>0)return;const txt=(el.textContent||'').trim();if(!txt)return;for(const lang of langPhrases){if(lang.has(txt)){candidates.push({el,lang});break;}}});if(candidates.length===0){console.log('â„¹ï¸ Resumo nÃ£o encontrado neste momento.');return;}
candidates.forEach(({el,lang})=>{const newSummary=lang.render(statsData.total_reviews);if(el.textContent.trim()!==newSummary){el.textContent=newSummary;console.log('âœ… Summary updated â†’',newSummary);}
const container=el.closest('div[class]')||el.parentElement||el;const walker=document.createTreeWalker(container,NodeFilter.SHOW_TEXT,null,false);const numRegex=/\b([1-5]\.[0-9])\b/;let avgUpdated=false;while(true){const node=walker.nextNode();if(!node)break;const t=node.textContent||'';if(numRegex.test(t)){const newAvg=statsData.average_rating.toFixed(1);const replaced=t.replace(numRegex,newAvg);if(replaced!==t){node.textContent=replaced;avgUpdated=true;console.log('âœ… Average updated in summary â†’',newAvg);break;}}}
if(!avgUpdated){console.log('â„¹ï¸ MÃ©dia nÃ£o encontrada no container do resumo (sem alterar cards).');}});}
function addUpdateIndicator(){}
async function performUpdate(){console.log('ðŸ”„ Iniciando atualizaÃ§Ã£o dos reviews...');const newStats=await fetchStats();if(newStats){statsData=newStats;updateRatingElements();}}
function observeDOM(){const observer=new MutationObserver((mutations)=>{let shouldUpdate=false;mutations.forEach((mutation)=>{if(mutation.type==='childList'){mutation.addedNodes.forEach((node)=>{if(node.nodeType===Node.ELEMENT_NODE){const text=node.textContent||'';if(/Based on|Baseado em|Basado en/i.test(text)||/\bGoogle reviews\b|avaliaÃ§Ãµes do Google|reseÃ±as de Google/i.test(text)){shouldUpdate=true;}}});}});if(shouldUpdate){console.log('ðŸ”„ Resumo detectado apÃ³s mudanÃ§a de idioma/DOM, atualizando...');setTimeout(performUpdate,100);}});observer.observe(document.body,{childList:true,subtree:true});}
function init(){console.log('ðŸš€ Inicializando atualizador de reviews...');performUpdate();updateInterval=setInterval(performUpdate,30000);observeDOM();console.log('âœ… Atualizador de reviews configurado!');}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}
window.updateSantosReviews=performUpdate;console.log('ðŸ“Š Santos Cleaning Solutions - Atualizador React carregado!');})();
